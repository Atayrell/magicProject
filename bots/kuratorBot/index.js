require("dotenv").config();
const TelegramBot = require("node-telegram-bot-api");

const bot = new TelegramBot(process.env.BOT_TOKEN, { polling: true });

// –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É
const paymentLink = "https://paywall.pw/wvxrz7kjqrxk";

// –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–∫–Ω–æ–ø–∫–∏)
const mainMenuKeyboard = [
  [{ text: "üî• –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É", callback_data: "subscribe" }],
  [{ text: "üìö –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ", callback_data: "subscribe_inf" }],
  [{ text: `‚ÄºÔ∏è –ü—Ä–∞–≤–∏–ª–∞ –∫–∞–Ω–∞–ª–∞`, callback_data: "channel_laws" }],
  [{ text: "üí¨ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å", callback_data: "faq" }],
];

bot.setMyCommands([{ command: "/start", description: "–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞" }]);

// –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
function getMainMenuText(firstName) {
  return `–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, ${firstName}!
–Ø —Ç–≤–æ–π –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫—É—Ä–∞—Ç–æ—Ä. –í—ã–±–µ—Ä–∏, —á—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å:`;
}

// –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤ —Ç.—á. /start) –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
bot.on("message", async (msg) => {
  const chatId = msg.chat.id;

  await bot.sendMessage(chatId, getMainMenuText(msg.from.first_name), {
    reply_markup: {
      inline_keyboard: mainMenuKeyboard,
    },
  });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫ (callback_data)
bot.on("callback_query", async (query) => {
  const chatId = query.message.chat.id;
  const messageId = query.message.message_id;
  const action = query.data;

  if (action === "subscribe") {
    // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∏ –∫–Ω–æ–ø–∫–∏ —Ç–æ–≥–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    await bot.editMessageText(
      `–ù–∞—à–∏ –ø–æ–¥–ø–∏—Å–∫–∏:
1Ô∏è‚É£ –º–µ—Å—è—Ü ‚Äì 25$,
3Ô∏è‚É£ –º–µ—Å—è—Ü–∞ ‚Äì 20$ (60$),
6Ô∏è‚É£ –º–µ—Å—è—Ü–µ–≤ ‚Äì 15$ (90$)

‚ÄºÔ∏è–ü–æ–¥–ø–∏—Å—ã–≤–∞—è—Å—å –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ, —á—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ –∏ —Å–æ–≥–ª–∞—Å–Ω—ã —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∫–∞–Ω–∞–ª–∞‚ÄºÔ∏è`,
      {
        chat_id: chatId,
        message_id: messageId,
        reply_markup: {
          inline_keyboard: [
            [{ text: "–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–¥–ø–∏—Å–∫–∞–º", url: paymentLink }],
            [
              {
                text: "–Ø –æ–ø–ª–∞—Ç–∏–ª ‚úÖ",
                callback_data: "subscribe_inf_&_channel_laws",
              },
            ],
            [{ text: `‚ÄºÔ∏è –ü—Ä–∞–≤–∏–ª–∞ –∫–∞–Ω–∞–ª–∞`, callback_data: "channel_laws" }],
            [{ text: "–ù–∞–∑–∞–¥", callback_data: "back_to_main" }],
          ],
        },
      }
    );
  } else if (action === "subscribe_inf") {
    await bot.editMessageText(
      `–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ —Å–≤–æ–∏—Ö –ø–æ–¥–ø–∏—Å–∫–∞—Ö, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ @Paywall_paybot

üìå –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:
1Ô∏è‚É£ –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ @Paywall_paybot
2Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –º–µ–Ω—é "–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏"
3Ô∏è‚É£ –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å`,
      {
        chat_id: chatId,
        message_id: messageId,
        reply_markup: {
          inline_keyboard: [[{ text: "–ù–∞–∑–∞–¥", callback_data: "back_to_main" }]],
        },
      }
    );
  } else if (action === "subscribe_inf_&_channel_laws") {
    await bot.editMessageText(
      `–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ —Å–≤–æ–∏—Ö –ø–æ–¥–ø–∏—Å–∫–∞—Ö, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ @Paywall_paybot

üìå –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:
1Ô∏è‚É£ –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ @Paywall_paybot
2Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –º–µ–Ω—é "–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏"
3Ô∏è‚É£ –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å

‚ÄºÔ∏è–í–ê–ñ–ù–û‚ÄºÔ∏è
–ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∫–∞–Ω–∞–ª–∞`,
      {
        chat_id: chatId,
        message_id: messageId,
        reply_markup: {
          inline_keyboard: [
            [{ text: "–ù–∞–∑–∞–¥", callback_data: "back_to_main" }],
            [{ text: `‚ÄºÔ∏è –ü—Ä–∞–≤–∏–ª–∞ –∫–∞–Ω–∞–ª–∞`, callback_data: "channel_laws" }],
          ],
        },
      }
    );
  } else if (action === "channel_laws") {
    await bot.editMessageText(
      `–ü–†–ê–í–ò–õ–ê –ù–ê–®–ï–ì–û TELEGRAM-–ö–ê–ù–ê–õ–ê

–î–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è –≤ –Ω–∞—à–µ–º —Å–æ–æ–±—â–µ—Å—Ç–≤–µ –ø—Ä–æ—Å–∏–º —Å–æ–±–ª—é–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:

‚ò†Ô∏è –ß—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ

–ì—Ä—É–±–æ—Å—Ç—å –∏ –Ω–µ—É–≤–∞–∂–µ–Ω–∏–µ ‚Äì –æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–º.
–†–µ–∫–ª–∞–º–∞ –∏ —Å—Å—ã–ª–∫–∏ ‚Äì –∑–∞–ø—Ä–µ—â–µ–Ω–æ —Ä–µ–∫–ª–∞–º–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ Telegram-–∫–∞–Ω–∞–ª—ã, —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ —Ä–∞–∑–º–µ—â–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã –±–µ–∑ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π.
–û—Ñ—Ñ—Ç–æ–ø ‚Äì –Ω–µ –∑–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —Ç–µ–º–µ –ø–æ—Å—Ç–∞.
–ù–µ–Ω—É–∂–Ω—ã–µ —Å–æ–≤–µ—Ç—ã ‚Äì –µ—Å–ª–∏ –≤–∞—Å –Ω–µ –ø—Ä–æ—Å—è—Ç –¥–∞—Ç—å —Å–æ–≤–µ—Ç, –Ω–µ –Ω–∞–≤—è–∑—ã–≤–∞–π—Ç–µ —Å–≤–æ—ë –º–Ω–µ–Ω–∏–µ.
–ü–µ—Ä–µ—Ç—è–≥–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ ‚Äì –∑–∞–ø—Ä–µ—â–µ–Ω–æ –ø—Ä—è–º–æ –∏–ª–∏ –Ω–∞—Ç–∏–≤–Ω–æ –≤–æ–≤–ª–µ–∫–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç—ã, –¥–∞–∂–µ –±–µ–∑ —è–≤–Ω–æ–π —Ä–µ–∫–ª–∞–º—ã.

‚úÖ –ß—Ç–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç—Å—è

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø–æ—Å—Ç—ã –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ä–µ–∞–∫—Ü–∏—è–º–∏ üëç ‚Äì —ç—Ç–æ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ.
–ï—Å–ª–∏ –∑–∞–º–µ—Ç–∏–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ, –æ—Ç–º–µ—Ç—å—Ç–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É.

üö® –ù–∞–∫–∞–∑–∞–Ω–∏—è –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ

–ü–µ—Ä–≤–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ ‚Äì –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.
–í—Ç–æ—Ä–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ ‚Äì –µ—â–µ –æ–¥–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.
–¢—Ä–µ—Ç—å–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ ‚Äì –±–∞–Ω –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

–ó–∞ –≥—Ä—É–±—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∞–º, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è) –º–æ–¥–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ä–∞–∑—É –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω.

üìå –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
–î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –æ–±—â–µ–º —á–∞—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª. –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –±—É–¥–µ—Ç –æ—Ç–ø–∏—Å–∞–Ω–∞ ‚Äì —É—á–∞—Å—Ç–Ω–∏–∫ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ —á–∞—Ç–∞.`,
      {
        chat_id: chatId,
        message_id: messageId,
        reply_markup: {
          inline_keyboard: [[{ text: "–ù–∞–∑–∞–¥", callback_data: "back_to_main" }]],
        },
      }
    );
  } else if (action === "faq") {
    await bot.editMessageText("‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:", {
      chat_id: chatId,
      message_id: messageId,
      reply_markup: {
        inline_keyboard: [
          [{ text: "–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É?", callback_data: "faq_sub" }],
          [{ text: "–ö–∞–∫ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É?", callback_data: "faq_cancel" }],
          [
            {
              text: "–ö–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π?",
              callback_data: "faq_support",
            },
          ],
          [{ text: "–ù–∞–∑–∞–¥", callback_data: "back_to_main" }],
        ],
      },
    });
  } else if (action === "faq_sub") {
    await bot.editMessageText(
      "üìå –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –≤ –º–µ–Ω—é ¬´–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É¬ª.",
      {
        chat_id: chatId,
        message_id: messageId,
        reply_markup: {
          inline_keyboard: [[{ text: "–ù–∞–∑–∞–¥", callback_data: "faq" }]],
        },
      }
    );
  } else if (action === "faq_cancel") {
    await bot.editMessageText(
      "üìå –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É, —Å–≤—è–∑–∞–≤—à–∏—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.",
      {
        chat_id: chatId,
        message_id: messageId,
        reply_markup: {
          inline_keyboard: [[{ text: "–ù–∞–∑–∞–¥", callback_data: "faq" }]],
        },
      }
    );
  } else if (action === "faq_support") {
    await bot.editMessageText("üìå –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π: @Dmitry_Astap", {
      chat_id: chatId,
      message_id: messageId,
      reply_markup: {
        inline_keyboard: [[{ text: "–ù–∞–∑–∞–¥", callback_data: "faq" }]],
      },
    });
  }

  // –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
  else if (action === "back_to_main") {
    await bot.editMessageText(getMainMenuText(query.from.first_name), {
      chat_id: chatId,
      message_id: messageId,
      reply_markup: {
        inline_keyboard: mainMenuKeyboard,
      },
    });
  }

  // –ó–∞–∫—Ä—ã–≤–∞–µ–º "—á–∞—Å–∏–∫–∏" —É –∫–Ω–æ–ø–∫–∏
  await bot.answerCallbackQuery(query.id);
});

console.log("üöÄ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!");
